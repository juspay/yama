# Yama Configuration Example
# Copy this file to yama.config.yaml and customize for your project

version: 2
configType: "yama-v2"

# ============================================================================
# Display & Streaming Configuration
# ============================================================================
display:
  showBanner: true # Show Yama banner on startup
  streamingMode: false # Enable real-time streaming of AI decisions
  verboseToolCalls: false # Log every MCP tool call
  showAIThinking: false # Display AI reasoning process

# ============================================================================
# AI Configuration
# ============================================================================
ai:
  provider: "auto" # auto | google-ai | anthropic | openai | bedrock
  model: "gemini-2.5-pro" # or claude-3-7-sonnet-20250219-v1:0, gpt-4, etc.
  temperature: 0.2 # Lower = more deterministic (0.0-1.0)
  maxTokens: 128000 # Maximum tokens per AI call
  enableAnalytics: true # Track token usage and costs
  enableEvaluation: false # Enable quality evaluation (slower)
  timeout: "15m" # Maximum time for review
  retryAttempts: 3 # Number of retries on failure

  # Conversation memory for maintaining review state
  conversationMemory:
    enabled: true
    store: "memory" # memory | redis
    maxSessions: 50
    maxTurnsPerSession: 300 # Long reviews need many turns
    enableSummarization: false # Don't summarize mid-review

# ============================================================================
# MCP Servers Configuration
# ============================================================================
# Bitbucket MCP is always enabled (hardcoded)
# Jira MCP can be enabled/disabled here
mcpServers:
  initializationTimeout: 120000 # Timeout in milliseconds (120000 = 2 minutes)
  jira:
    enabled: true # Set to false to disable Jira integration

# ============================================================================
# Review Configuration
# ============================================================================
review:
  enabled: true

  # High-level workflow instructions (combined with base system prompt)
  workflowInstructions: |
    Follow the autonomous review workflow:
    1. Read PR details and find Jira ticket
    2. Read project standards from memory-bank
    3. Analyze files one-by-one
    4. Search code for context as needed
    5. Comment on issues immediately
    6. Make final decision based on blocking criteria

  # Analysis focus areas (in priority order)
  focusAreas:
    - name: "Security Analysis"
      priority: "CRITICAL"
      description: |
        - SQL/NoSQL injection vulnerabilities
        - Cross-Site Scripting (XSS)
        - Authentication/Authorization flaws
        - Hardcoded secrets, API keys, passwords
        - Input validation and sanitization
        - Data exposure and privacy violations

    - name: "Performance Review"
      priority: "MAJOR"
      description: |
        - N+1 database query patterns
        - Memory leaks and resource management
        - Algorithm complexity issues
        - Missing caching opportunities
        - Blocking I/O in async contexts

    - name: "Code Quality"
      priority: "MAJOR"
      description: |
        - SOLID principle violations
        - Poor error handling
        - Code duplication (DRY violations)
        - Poor naming conventions
        - Missing edge case handling

  # Blocking criteria (AI uses these to decide whether to block PR)
  blockingCriteria:
    - condition: "ANY CRITICAL severity issue"
      action: "BLOCK"
      reason: "Security or data loss risk"

    - condition: "3 or more MAJOR severity issues"
      action: "BLOCK"
      reason: "Too many significant bugs/performance issues"

    - condition: "Jira requirement coverage < 70%"
      action: "BLOCK"
      reason: "Incomplete implementation of requirements"

  # Files to exclude from analysis
  excludePatterns:
    - "*.lock"
    - "*.svg"
    - "*.min.js"
    - "*.map"
    - "package-lock.json"
    - "pnpm-lock.yaml"
    - "yarn.lock"

  # Context settings
  contextLines: 3 # Lines of context around each diff change
  maxFilesPerReview: 100 # Maximum files to review
  fileAnalysisTimeout: "2m" # Timeout per file

  # Tool usage preferences
  toolPreferences:
    lazyLoading: true # Read files on-demand (RECOMMENDED)
    cacheToolResults: true # Cache MCP tool responses
    parallelToolCalls: false # Sequential for better context
    maxToolCallsPerFile: 20 # Prevent infinite loops
    enableCodeSearch: true # Allow search_code() usage
    enableDirectoryListing: true # Allow list_directory_content()

# ============================================================================
# PR Description Enhancement
# ============================================================================
descriptionEnhancement:
  enabled: true

  instructions: |
    Enhance the PR description using Jira requirements and diff analysis.
    Generate comprehensive, well-structured description with all required sections.

  requiredSections:
    - key: "summary"
      name: "ðŸ“‹ Summary"
      required: true
      description: "Clear overview of what this PR accomplishes"

    - key: "changes"
      name: "ðŸ”§ Changes Made"
      required: true
      description: "Specific technical changes with file references"

    - key: "jira"
      name: "ðŸŽ« Jira Reference"
      required: false
      description: "Link to Jira ticket and requirement coverage"

    - key: "testing"
      name: "ðŸ§ª Testing Strategy"
      required: true
      description: "How changes were tested and validation approach"

    - key: "impact"
      name: "âš¡ Impact & Considerations"
      required: false
      description: "Business impact, performance implications, breaking changes"

  preserveContent: true # Don't remove existing images/links/tables
  autoFormat: true # Clean up markdown formatting

# ============================================================================
# Memory Bank & Project Context
# ============================================================================
memoryBank:
  enabled: true
  path: "memory-bank"
  fallbackPaths:
    - "docs/memory-bank"
    - ".memory-bank"

  # Standard files to read for project context
  standardFiles:
    - "project-overview.md"
    - "architecture.md"
    - "coding-standards.md"
    - "security-guidelines.md"

# ============================================================================
# Project-Specific Standards (Override in your repository)
# ============================================================================
projectStandards:
  # Path to project-specific prompt files (relative to repo root)
  customPromptsPath: "config/prompts/"

  # Additional focus areas beyond defaults
  additionalFocusAreas: []

  # Custom blocking rules
  customBlockingRules: []

  # Severity level overrides
  severityOverrides: {}

# ============================================================================
# Monitoring & Analytics
# ============================================================================
monitoring:
  enabled: true
  logToolCalls: true # Log every MCP tool execution
  logAIDecisions: true # Log AI decision points
  logTokenUsage: true # Log token usage for cost tracking
  exportFormat: "json" # json | csv
  exportPath: ".yama/analytics/"

# ============================================================================
# Performance & Cost Controls
# ============================================================================
performance:
  maxReviewDuration: "15m" # Kill switch for long reviews

  tokenBudget:
    maxTokensPerReview: 500000 # Hard limit on tokens
    warningThreshold: 400000 # Warn when approaching limit

  costControls:
    maxCostPerReview: 2.0 # USD limit per review
    warningThreshold: 1.5 # Warn at $1.50
